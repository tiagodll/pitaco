<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>this test app</title>
</head>
<body>
    <H1>QUARUM AMBARUM RERUM CUM MEDICINAM POLLICETUR, LUXURIAE LICENTIAM POLLICETUR.</H1>

<P>LOREM IPSUM DOLOR SIT AMET, CONSECTETUR ADIPISCING ELIT. ITAQUE HIS SAPIENS SEMPER VACABIT. <A HREF='HTTP://LORIPSUM.NET/' TARGET='_BLANK'>NIHIL SANE.</A> SED AD ILLUM REDEO. BONUM PATRIA: MISERUM EXILIUM. </P>

<BLOCKQUOTE CITE='HTTP://LORIPSUM.NET'>
	SI VERO ID ETIAM EXPLANARE VELLES APERTIUSQUE DICERES NIHIL EUM FECISSE NISI VOLUPTATIS CAUSA, QUO MODO EUM TANDEM LATURUM FUISSE EXISTIMAS?
</BLOCKQUOTE>


<UL>
	<LI>ALIENA DIXIT IN PHYSICIS NEC EA IPSA, QUAE TIBI PROBARENTUR;</LI>
	<LI>SED QUID MINUS PROBANDUM QUAM ESSE ALIQUEM BEATUM NEC SATIS BEATUM?</LI>
</UL>


<OL>
	<LI>EQUIDEM ETIAM EPICURUM, IN PHYSICIS QUIDEM, DEMOCRITEUM PUTO.</LI>
	<LI>CONSEQUENTIA EXQUIRERE, QUOAD SIT ID, QUOD VOLUMUS, EFFECTUM.</LI>
	<LI>QUO MODO AUTEM OPTIMUM, SI BONUM PRAETEREA NULLUM EST?</LI>
	<LI>ITAQUE NOSTRUM EST-QUOD NOSTRUM DICO, ARTIS EST-AD EA PRINCIPIA, QUAE ACCEPIMUS.</LI>
	<LI>NEC ENIM IGNORAS HIS ISTUD HONESTUM NON SUMMUM MODO, SED ETIAM, UT TU VIS, SOLUM BONUM VIDERI.</LI>
</OL>


<P>DUO REGES: CONSTRUCTIO INTERRETE. UTILITATIS CAUSA AMICITIA EST QUAESITA. <B>ISTIC SUM, INQUIT.</B> <B>VIDE, QUAESO, RECTUMNE SIT.</B> QUOD AUTEM RATIONE ACTUM EST, ID OFFICIUM APPELLAMUS. QUAE CUM DIXISSET, FINEM ILLE. </P>

<div id="pitaco" />


<script type="text/javascript">
	((id) => {
		let base = document.getElementById("pitaco");
		if(typeof(base) === undefined)
			console.log("### PITACO is missing a div with id 'pitaco'");
		
		let loadComments = () => {
			let xhr = new XMLHttpRequest();
			xhr.open("POST", "https://localhost:5001/api/getComments");
			xhr.setRequestHeader('Content-type', 'application/json')
			xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
			xhr.overrideMimeType("text/html");
			xhr.send(`"${id}"`)
			xhr.onreadystatechange = function() {
				if(xhr.readyState === 4 && xhr.status === 200) {
					let resp = "";
					for(let comment of JSON.parse(xhr.responseText))
						resp += `<li>${comment.text} - ${comment.author}</li>`;
					document.getElementById('pitaco_commentBoxLog').innerHTML = resp;
				}
			}
		}

		let postComment = () => {
			let client = new XMLHttpRequest();
			client.open("POST", "https://localhost:5001/api/addComment");
			client.setRequestHeader('Content-type', 'application/json')
			client.setRequestHeader('X-Requested-With', 'XMLHttpRequest')
			client.overrideMimeType('text/html')
			client.send(JSON.stringify({
				wskey: id,
				url: "localhost:5001",
				text: document.getElementById("pitaco_comment").value,
				author: document.getElementById("pitaco_author").value
			}));
			client.onreadystatechange = function() {
				if(client.readyState === 4 && client.status === 200) {
					document.getElementById("pitaco_comment").value = ""
					document.getElementById("pitaco_author").value = ""
					loadComments();
				}
			}
		}

		base.innerHTML = "<ul id='pitaco_commentBoxLog'></ul>"
				+ "Message: <br><textarea id='pitaco_comment'></textarea><br>"
				+ "Author: <br><input type='text' id='pitaco_author' />";
		
		let btn = document.createElement("button");
		btn.innerText= "Post";
		btn.onclick = postComment
		base.append(btn);
		
		loadComments();

	})("test");
</script>

</body>
</html>